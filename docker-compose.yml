services:
  calculador:
    image: renaneunao/saas-cartola-calculador:latest
    container_name: cartola-aero-calculador-container
    restart: unless-stopped
    env_file:
      - .env
    environment:
      POSTGRES_HOST: ${POSTGRES_HOST}
      POSTGRES_PORT: ${POSTGRES_PORT:-5432}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
      CALCULATION_INTERVAL_MINUTES: ${CALCULATION_INTERVAL_MINUTES:-15}
    volumes:
      - ./logs:/app/logs
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - infra_network

  web-app:
    build:
      context: .
      dockerfile: Dockerfile
    image: renaneunao/saas-cartola-web-app:latest
    container_name: cartola-aero-web-app-container
    restart: unless-stopped
    env_file:
      - .env
    environment:
      POSTGRES_HOST: ${POSTGRES_HOST}
      POSTGRES_PORT: ${POSTGRES_PORT:-5432}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
      SECRET_KEY: ${SECRET_KEY:-change-me-to-a-secure-random-value-in-production}
      FLASK_ENV: ${FLASK_ENV:-production}
      # Stripe - Chaves de API
      STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY}
      STRIPE_WEBHOOK_SECRET: ${STRIPE_WEBHOOK_SECRET}
      # Stripe - IDs dos Produtos
      STRIPE_PRODUCT_STARTER: ${STRIPE_PRODUCT_STARTER}
      STRIPE_PRODUCT_PRO_PLUS: ${STRIPE_PRODUCT_PRO_PLUS}
      # Domínio da aplicação
      DOMAIN: ${DOMAIN:-http://localhost:5000}
    ports:
      - "5000:5000"
    volumes:
      - ./logs:/app/logs
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - infra_network
    depends_on:
      - calculador

networks:
  infra_network:
    external: true

