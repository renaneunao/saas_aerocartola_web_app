services:
  web-app:
    build:
      context: .
      dockerfile: Dockerfile
    image: renaneunao/saas-cartola-web-app:latest
    container_name: cartola-aero-web-app-container
    restart: unless-stopped
    env_file:
      - .env
    environment:
      # PostgreSQL
      POSTGRES_HOST: ${POSTGRES_HOST}
      POSTGRES_PORT: ${POSTGRES_PORT:-5432}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
      # Flask
      SECRET_KEY: ${SECRET_KEY:-change-me-to-a-secure-random-value-in-production}
      FLASK_ENV: ${FLASK_ENV:-production}
      # Stripe - Chaves de API (obrigatórias)
      STRIPE_SECRET_KEY: ${STRIPE_SECRET_KEY}
      STRIPE_WEBHOOK_SECRET: ${STRIPE_WEBHOOK_SECRET}
      # Stripe - IDs dos Produtos (obrigatórias)
      STRIPE_PRODUCT_STARTER: ${STRIPE_PRODUCT_STARTER}
      STRIPE_PRODUCT_PRO_PLUS: ${STRIPE_PRODUCT_PRO_PLUS}
      # Stripe - IDs dos Produtos (opcionais, com fallback)
      STRIPE_PRODUCT_AVANCADO: ${STRIPE_PRODUCT_AVANCADO}
      STRIPE_PRODUCT_PRO: ${STRIPE_PRODUCT_PRO}
      # URLs da aplicação
      DOMAIN: ${DOMAIN}
      BASE_URL: ${BASE_URL}
      # Brevo - Configurações de Email SMTP
      BREVO_SMTP_SERVER: ${BREVO_SMTP_SERVER:-smtp-relay.brevo.com}
      BREVO_SMTP_PORT: ${BREVO_SMTP_PORT:-587}
      BREVO_SMTP_LOGIN: ${BREVO_SMTP_LOGIN}
      BREVO_SMTP_PASSWORD: ${BREVO_SMTP_PASSWORD}
      BREVO_SENDER_EMAIL: ${BREVO_SENDER_EMAIL}
      BREVO_SENDER_NAME: ${BREVO_SENDER_NAME:-Aero Cartola}
      # Criptografia para senhas (Fernet key)
      CRYPTO_KEY: ${CRYPTO_KEY}
      # Redis - Configurações de Sessão
      REDIS_HOST: ${REDIS_HOST:-redis_cache}
      REDIS_PORT: ${REDIS_PORT:-6379}
      REDIS_PASSWORD: ${REDIS_PASSWORD}
      REDIS_DB: ${REDIS_DB:-0}
    ports:
      - "5000:5000"
    volumes:
      - ./logs:/app/logs
    networks:
      - infra_network

networks:
  infra_network:
    external: true

