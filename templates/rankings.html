{% extends "base.html" %}
{% block title %}Rankings - Cartola FC Manager{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="text-center mb-8">
    <div class="flex items-center justify-center space-x-3 mb-4">
        <div class="p-3 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl shadow-lg animate-pulse-glow">
            <i class="fas fa-trophy text-2xl text-white"></i>
        </div>
        <h1 class="text-4xl font-bold bg-gradient-to-r from-white to-yellow-200 bg-clip-text text-transparent">
            Rankings por Posição
        </h1>
    </div>
    <div class="flex items-center justify-center space-x-2 text-dark-blue-200">
        <i class="fas fa-calendar-alt"></i>
        <span class="text-lg">Rodada {{ rodada_atual }}</span>
    </div>
</div>

{% if not rankings %}
    <!-- No Data State -->
    <div class="max-w-2xl mx-auto text-center">
        <div class="bg-gradient-to-br from-yellow-900/50 to-orange-900/50 backdrop-blur-sm rounded-2xl p-8 border border-yellow-500/50">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-yellow-500/20 rounded-full mb-4">
                <i class="fas fa-exclamation-triangle text-yellow-400 text-2xl"></i>
            </div>
            <h3 class="text-xl font-semibold text-yellow-200 mb-2">Nenhum ranking encontrado</h3>
            <p class="text-yellow-300/80 mb-6">Execute o cálculo dos rankings primeiro para ver os melhores jogadores por posição.</p>
            <a href="{{ url_for('modulos') }}" class="inline-flex items-center space-x-2 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-200 transform hover:scale-105">
                <i class="fas fa-calculator"></i>
                <span>Calcular Rankings</span>
            </a>
        </div>
    </div>
{% else %}
    <!-- Position Navigation -->
    <div class="mb-8">
        <div class="flex flex-wrap justify-center gap-2" role="tablist">
            {% for posicao_id, data in rankings.items() %}
            <button class="position-tab px-4 py-2 md:px-6 md:py-3 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2 {% if loop.first %}bg-gradient-to-r from-dark-blue-600 to-dark-blue-700 text-white shadow-lg{% else %}bg-dark-blue-800/50 text-dark-blue-200 hover:bg-dark-blue-700/50 hover:text-white{% endif %}"
                    data-position="{{ posicao_id }}"
                    onclick="showPosition({{ posicao_id }})">
                <i class="{{ data.icon }} text-sm md:text-base"></i>
                <span class="text-sm md:text-base">{{ data.nome }}</span>
                <span class="bg-dark-blue-900/50 text-dark-blue-200 px-2 py-1 rounded-full text-xs">{{ data.jogadores|length }}</span>
            </button>
            {% endfor %}
        </div>
    </div>

    <!-- Position Content -->
    <div class="space-y-8">
        {% for posicao_id, data in rankings.items() %}
        <div class="position-content {% if not loop.first %}hidden{% endif %}" data-position="{{ posicao_id }}">
            <div class="bg-gradient-to-br from-dark-blue-800/50 to-dark-blue-900/50 backdrop-blur-sm rounded-2xl border border-dark-blue-700/50 shadow-2xl overflow-hidden">
                <!-- Section Header -->
                <div class="bg-gradient-to-r from-dark-blue-700/80 to-dark-blue-800/80 p-6 border-b border-dark-blue-700/50">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="p-2 bg-gradient-to-br from-{{ 'green' if posicao_id == 1 else 'blue' if posicao_id == 2 else 'red' if posicao_id == 3 else 'purple' if posicao_id == 4 else 'orange' if posicao_id == 5 else 'indigo' }}-500 to-{{ 'green' if posicao_id == 1 else 'blue' if posicao_id == 2 else 'red' if posicao_id == 3 else 'purple' if posicao_id == 4 else 'orange' if posicao_id == 5 else 'indigo' }}-600 rounded-lg shadow-lg">
                                <i class="{{ data.icon }} text-white text-xl"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold text-white">Top {{ data.jogadores|length }} {{ data.nome }}</h2>
                                <p class="text-dark-blue-200 text-sm">Melhores jogadores da posição</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-white">{{ data.jogadores|length }}</div>
                            <div class="text-dark-blue-200 text-sm">jogadores</div>
                        </div>
                    </div>
                </div>

                <!-- Players List -->
                {% if data.jogadores %}
                <div class="p-6">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-dark-blue-700/50">
                                    <th class="text-left py-3 px-2 text-dark-blue-200 font-medium">Rank</th>
                                    <th class="text-left py-3 px-2 text-dark-blue-200 font-medium">Jogador</th>
                                    <th class="text-left py-3 px-2 text-dark-blue-200 font-medium">Clube</th>
                                    <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Pontuação</th>
                                    <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Média</th>
                                    <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Jogos</th>
                                    <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Peso Jogo</th>
                                    <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Peso SG</th>
                                    <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Preço</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for jogador in data.jogadores %}
                                <tr class="border-b border-dark-blue-700/30 hover:bg-dark-blue-800/30 transition-colors duration-200 {% if jogador.rank <= 3 %}bg-gradient-to-r {% if jogador.rank == 1 %}from-yellow-900/20 to-yellow-800/20{% elif jogador.rank == 2 %}from-gray-800/20 to-gray-700/20{% elif jogador.rank == 3 %}from-orange-900/20 to-orange-800/20{% endif %}{% endif %}">
                                    <td class="py-4 px-2">
                                        {% if jogador.rank <= 3 %}
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full {% if jogador.rank == 1 %}bg-gradient-to-br from-yellow-400 to-yellow-500 text-yellow-900{% elif jogador.rank == 2 %}bg-gradient-to-br from-gray-300 to-gray-400 text-gray-800{% elif jogador.rank == 3 %}bg-gradient-to-br from-orange-400 to-orange-500 text-orange-900{% endif %} shadow-lg">
                                            {% if jogador.rank == 1 %}
                                                <i class="fas fa-crown text-sm"></i>
                                            {% elif jogador.rank == 2 %}
                                                <i class="fas fa-medal text-sm"></i>
                                            {% elif jogador.rank == 3 %}
                                                <i class="fas fa-award text-sm"></i>
                                            {% endif %}
                                        </div>
                                        {% else %}
                                        <div class="flex items-center justify-center w-8 h-8 rounded-full bg-dark-blue-700/50 text-dark-blue-200 font-bold text-sm">
                                            {{ jogador.rank }}
                                        </div>
                                        {% endif %}
                                    </td>
                                    <td class="py-4 px-2">
                                        <div>
                                            <div class="font-bold text-white">{{ jogador.apelido }}</div>
                                            <div class="text-xs text-dark-blue-400">ID: {{ jogador.atleta_id }}</div>
                                        </div>
                                    </td>
                                    <td class="py-4 px-2">
                                        <div>
                                            <div class="font-medium text-white">{{ jogador.clube_nome }}</div>
                                            <div class="text-xs text-dark-blue-400">{{ jogador.clube_nome }}</div>
                                        </div>
                                    </td>
                                    <td class="py-4 px-2 text-center">
                                        <div class="text-lg font-bold {% if jogador.pontuacao_total >= 10 %}text-green-400{% elif jogador.pontuacao_total >= 5 %}text-yellow-400{% else %}text-red-400{% endif %}">
                                            {{ "%.2f"|format(jogador.pontuacao_total) }}
                                        </div>
                                    </td>
                                    <td class="py-4 px-2 text-center">
                                        <div class="font-medium text-white">{{ "%.2f"|format(jogador.media) }}</div>
                                    </td>
                                    <td class="py-4 px-2 text-center">
                                        <div class="font-medium text-white">{{ jogador.jogos }}</div>
                                    </td>
                                    <td class="py-4 px-2 text-center">
                                        <div class="font-medium {% if jogador.peso_jogo > 0 %}text-green-400{% elif jogador.peso_jogo < 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                                            {{ "%.2f"|format(jogador.peso_jogo) }}
                                        </div>
                                    </td>
                                    <td class="py-4 px-2 text-center">
                                        <div class="font-medium {% if jogador.peso_sg > 0 %}text-green-400{% elif jogador.peso_sg < 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                                            {{ "%.2f"|format(jogador.peso_sg) }}
                                        </div>
                                    </td>
                                    <td class="py-4 px-2 text-center">
                                        <div class="font-medium text-green-400">R$ {{ "%.2f"|format(jogador.preco) }}</div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% else %}
                <div class="p-8 text-center">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-500/20 rounded-full mb-4">
                        <i class="fas fa-info-circle text-blue-400 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-white mb-2">Nenhum jogador encontrado</h3>
                    <p class="text-dark-blue-400">Não há dados disponíveis para {{ data.nome }}.</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Resumo dos Confrontos - Peso de Jogo -->
    {% if peso_jogo_rankings %}
    <div class="mt-12">
        <div class="bg-gradient-to-br from-dark-blue-800/50 to-dark-blue-900/50 backdrop-blur-sm rounded-2xl border border-dark-blue-700/50 shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-dark-blue-700/80 to-dark-blue-800/80 p-6 border-b border-dark-blue-700/50">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-lg">
                        <i class="fas fa-weight-hanging text-white text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">Resumo dos Confrontos - Rodada {{ rodada_atual }}</h2>
                        <p class="text-dark-blue-200 text-sm">Confrontos ordenados por Peso Final (igual ao calculo_peso_jogo.py)</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-dark-blue-700/50">
                                <th class="text-left py-3 px-2 text-dark-blue-200 font-medium">Casa</th>
                                <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Peso Casa</th>
                                <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Peso Fora</th>
                                <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Peso Final</th>
                                <th class="text-left py-3 px-2 text-dark-blue-200 font-medium">Fora</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for match in peso_jogo_rankings %}
                            <tr class="border-b border-dark-blue-700/30 hover:bg-dark-blue-800/30 transition-colors duration-200">
                                <td class="py-4 px-2">
                                    <div class="font-medium text-white">{{ match.casa }}</div>
                                </td>
                                <td class="py-4 px-2 text-center">
                                    <div class="font-medium {% if match.peso_casa > 0 %}text-green-400{% elif match.peso_casa < 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                                        {{ "%.2f"|format(match.peso_casa) }}
                                    </div>
                                </td>
                                <td class="py-4 px-2 text-center">
                                    <div class="font-medium {% if match.peso_visitante > 0 %}text-green-400{% elif match.peso_visitante < 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                                        {{ "%.2f"|format(match.peso_visitante) }}
                                    </div>
                                </td>
                                <td class="py-4 px-2 text-center">
                                    <div class="font-bold {% if match.peso_final > 1 %}text-yellow-400{% elif match.peso_final > 0.5 %}text-orange-400{% elif match.peso_final > 0 %}text-green-400{% elif match.peso_final < -1 %}text-red-400{% elif match.peso_final < -0.5 %}text-orange-400{% else %}text-gray-400{% endif %}">
                                        {{ "%.2f"|format(match.peso_final) }}
                                    </div>
                                </td>
                                <td class="py-4 px-2">
                                    <div class="font-medium text-white">{{ match.visitante }}</div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Times Favoritos -->
    {% if times_favoritos %}
    <div class="mt-8">
        <div class="bg-gradient-to-br from-dark-blue-800/50 to-dark-blue-900/50 backdrop-blur-sm rounded-2xl border border-dark-blue-700/50 shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-dark-blue-700/80 to-dark-blue-800/80 p-6 border-b border-dark-blue-700/50">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg shadow-lg">
                        <i class="fas fa-trophy text-white text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">Times Favoritos - Rodada {{ rodada_atual }}</h2>
                        <p class="text-dark-blue-200 text-sm">Ranking de times ordenados por peso (igual ao calculo_peso_jogo.py)</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-dark-blue-700/50">
                                <th class="text-left py-3 px-2 text-dark-blue-200 font-medium">Time</th>
                                <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Peso</th>
                                <th class="text-left py-3 px-2 text-dark-blue-200 font-medium">Adversário</th>
                                <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Situação</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for time in times_favoritos %}
                            <tr class="border-b border-dark-blue-700/30 hover:bg-dark-blue-800/30 transition-colors duration-200">
                                <td class="py-4 px-2">
                                    <div class="font-medium text-white">{{ time.time }}</div>
                                </td>
                                <td class="py-4 px-2 text-center">
                                    <div class="font-bold {% if time.peso > 1 %}text-yellow-400{% elif time.peso > 0.5 %}text-orange-400{% elif time.peso > 0 %}text-green-400{% elif time.peso < -1 %}text-red-400{% elif time.peso < -0.5 %}text-orange-400{% else %}text-gray-400{% endif %}">
                                        {{ "%+.2f"|format(time.peso) }}
                                    </div>
                                </td>
                                <td class="py-4 px-2">
                                    <div class="font-medium text-white">{{ time.adversario }}</div>
                                </td>
                                <td class="py-4 px-2 text-center">
                                    <span class="px-2 py-1 text-xs font-medium rounded-full {% if time.situacao == 'Casa' %}bg-green-500/20 text-green-300 border border-green-500/50{% else %}bg-blue-500/20 text-blue-300 border border-blue-500/50{% endif %}">
                                        {{ time.situacao }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Peso SG Rankings -->
    {% if peso_sg_rankings %}
    <div class="mt-8">
        <div class="bg-gradient-to-br from-dark-blue-800/50 to-dark-blue-900/50 backdrop-blur-sm rounded-2xl border border-dark-blue-700/50 shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-dark-blue-700/80 to-dark-blue-800/80 p-6 border-b border-dark-blue-700/50">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg shadow-lg">
                        <i class="fas fa-chart-line text-white text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white">Ranking Peso SG</h2>
                        <p class="text-dark-blue-200 text-sm">Confrontos ordenados por diferença de peso SG</p>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-dark-blue-700/50">
                                <th class="text-left py-3 px-2 text-dark-blue-200 font-medium">Casa</th>
                                <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">SG Casa</th>
                                <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">SG Visitante</th>
                                <th class="text-center py-3 px-2 text-dark-blue-200 font-medium">Diferença</th>
                                <th class="text-left py-3 px-2 text-dark-blue-200 font-medium">Visitante</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for match in peso_sg_rankings %}
                            <tr class="border-b border-dark-blue-700/30 hover:bg-dark-blue-800/30 transition-colors duration-200">
                                <td class="py-4 px-2">
                                    <div class="font-medium text-white">{{ match.casa }}</div>
                                </td>
                                <td class="py-4 px-2 text-center">
                                    <div class="font-medium {% if match.sg_casa > 0 %}text-green-400{% elif match.sg_casa < 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                                        {{ "%.2f"|format(match.sg_casa) }}
                                    </div>
                                </td>
                                <td class="py-4 px-2 text-center">
                                    <div class="font-medium {% if match.sg_visitante > 0 %}text-green-400{% elif match.sg_visitante < 0 %}text-red-400{% else %}text-gray-400{% endif %}">
                                        {{ "%.2f"|format(match.sg_visitante) }}
                                    </div>
                                </td>
                                <td class="py-4 px-2 text-center">
                                    <div class="font-bold {% if match.diferenca > 0.5 %}text-yellow-400{% elif match.diferenca > 0.2 %}text-orange-400{% else %}text-gray-400{% endif %}">
                                        {{ "%.2f"|format(match.diferenca) }}
                                    </div>
                                </td>
                                <td class="py-4 px-2">
                                    <div class="font-medium text-white">{{ match.visitante }}</div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Info Section -->
    <div class="mt-12">
        <div class="bg-gradient-to-br from-blue-900/50 to-indigo-900/50 backdrop-blur-sm rounded-2xl p-6 border border-blue-500/50">
            <div class="flex items-start space-x-4">
                <div class="p-2 bg-blue-500/20 rounded-lg">
                    <i class="fas fa-info-circle text-blue-400 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-white mb-4">Como funciona o ranking</h3>
                    <div class="grid md:grid-cols-2 gap-4 text-blue-200">
                        <div>
                            <h4 class="font-medium text-blue-100 mb-2">
                                <i class="fas fa-calculator text-blue-400 mr-2"></i>
                                Pontuação Total
                            </h4>
                            <p class="text-sm">Calculada com base nos pesos configurados para cada posição, considerando performance histórica e estatísticas avançadas.</p>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-blue-100 mb-2">
                                <i class="fas fa-medal text-blue-400 mr-2"></i>
                                Top 3
                            </h4>
                            <p class="text-sm">Os três primeiros colocados são destacados com medalhas especiais e cores diferenciadas.</p>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-blue-100 mb-2">
                                <i class="fas fa-palette text-blue-400 mr-2"></i>
                                Cores da Pontuação
                            </h4>
                            <div class="space-y-1 text-sm">
                                <div><span class="text-green-400 font-bold">Verde (≥10)</span> - Excelente</div>
                                <div><span class="text-yellow-400 font-bold">Amarelo (≥5)</span> - Bom</div>
                                <div><span class="text-red-400 font-bold">Vermelho (<5)</span> - Regular</div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-blue-100 mb-2">
                                <i class="fas fa-sync text-blue-400 mr-2"></i>
                                Atualização
                            </h4>
                            <p class="text-sm">Os rankings são recalculados automaticamente a cada execução do sistema, garantindo dados sempre atualizados.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}

<script>
function showPosition(positionId) {
    // Hide all position contents
    document.querySelectorAll('.position-content').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Show selected position content
    const targetContent = document.querySelector(`.position-content[data-position="${positionId}"]`);
    if (targetContent) {
        targetContent.classList.remove('hidden');
    }
    
    // Update tab styles
    document.querySelectorAll('.position-tab').forEach(tab => {
        const tabPositionId = tab.getAttribute('data-position');
        
        if (tabPositionId == positionId) {
            // Active tab
            tab.className = 'position-tab px-4 py-2 md:px-6 md:py-3 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2 bg-gradient-to-r from-dark-blue-600 to-dark-blue-700 text-white shadow-lg';
        } else {
            // Inactive tab
            tab.className = 'position-tab px-4 py-2 md:px-6 md:py-3 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2 bg-dark-blue-800/50 text-dark-blue-200 hover:bg-dark-blue-700/50 hover:text-white';
        }
    });
}

// Add smooth scroll animation for better UX
document.querySelectorAll('.position-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        this.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });
});
</script>
{% endblock %}